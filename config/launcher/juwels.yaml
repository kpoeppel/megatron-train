image: "${oc.env:CONTAINER_CACHE_DIR,:}/MegatronTraining_x86_64_202509131424.sif"
distributed_args: " --nproc-per-node ${slurm.gpus_per_node} --nnodes ${slurm.nodes} "
cmd: "{{ env_exports }} LOCAL_ADDR=$(nslookup $(hostname | sed 's/.juwels//' )i | grep \"Address: \" | tail -n1 | awk '{print $2}') ; echo CUDA_VISIBLE_DEVICES $CUDA_VISIBLE_DEVICES ;   singularity exec --mount src=/p/,destination=/p/ {{ env_exports_singularity }}  --nv ${.image} python -u -m torch.distributed.run ${.distributed_args} --max-restarts 0 --tee 3  --rdzv-endpoint $MASTER_ADDR:$MASTER_PORT --rdzv-backend static --node-rank $SLURM_NODEID --local-addr $LOCAL_ADDR --master-addr $MASTER_ADDR --master-port $MASTER_PORT"

# 